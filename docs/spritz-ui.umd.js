!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["spritz-ui"]={})}(this,(function(t){"use strict";const e=Object.assign({'"':'"',"“":"”","«":"»","‹":" ›","‘":"’","‚":"‘","„":"“"},{"(":")","[":"]","{":"}","<":">","⌈":"⌉","⌊":"⌋","⸢":"⸣","⸤":"⸥"});function s(t){return"\\u"+t.charCodeAt(0).toString(16).padStart(4,"0")}const n=function(){const t=Object.keys(e).map(s).join("");return new RegExp(`^[${t}]+`,"g")}(),i=function(){const t=Object.values(e).map(s).join("");return new RegExp(`[${t}]+$`,"g")}(),r=function(){const t=Object.keys(e).map(s).join(""),n=Object.values(e).map(s).join("");return new RegExp(`[${t+n}]+`,"g")}();class a{constructor(){this.start=[],this.end=[]}check(t){return d.call(this,function(t){return t.replace(/[.?!,;:]/g,"")}(t))}}function o(t,e){const[s]=t.match(e)||[""];return s.split("")}function d(t){const s=o(t,n),r=o(t,i),a=s.filter(t=>!r.includes(e[t])),d={start:this.start.slice(),end:this.end.slice()};return s.length&&!a.length?{start:s,end:r}:(r.length&&r.forEach(t=>{const s=this.end.indexOf(t);let n=this.start.length-1-s;if(!e[this.start[n]]===t){const s=Object.entries(e).reduce((e,[s,n])=>n===t?s:e,null);n=this.start.indexOf(s)}this.end.splice(s,1),this.start.splice(n,1)}),s.length&&(s.forEach(t=>{d.start.push(t),d.end.unshift(e[t])}),this.start=d.start.slice(),this.end=d.end.slice()),d)}const c=["a.m.","a.d.","ave.","b.a.","b.s.","blvd.","capt.","ct.","d.c.","dept.","dr.","eg.","est.","etc.","ie.","jr.","ltd.","mr.","mrs.","mo.","no.","rd.","sr.","st.","ste.","tpk.","univ.","u.s.","v.s."],h={clause:t=>/[,:;]$/.test(t)?1.5:1,number:t=>/\d+[^,:;.!?]{0,}$/.test(t)?1.5:1,sentence:t=>/[.?!]$/.test(t)&&!c.includes(t.toLowerCase())?3:1},u=/((?=\w{15,})(\w{7})|(?!^\w{1,14})$)/g,l=/[^\s-]+-?/g;function p(t){const e=Math.ceil((t.length-1)/4);return/\W/.test(t[e])?e-1:e}function f(t,e){return Math.max(Math.min(t,e.length-1),0)}function m({elem:t,key:e,value:s,check:n}){(n=n||Boolean)(s=function(t){return"boolean"==typeof t?"":Array.isArray(t)?t.join(""):t}(s))?t.setAttribute(e,s):t.removeAttribute(e)}const w={STATUS_STOPPED:"stopped",STATUS_PAUSED:"paused",STATUS_PLAYING:"playing"};class _ extends window.HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML='<style>:host{display:inline-block;font-size:2em;--verticalPadding:1ch}:host([prewrap]):before{padding:var(--verticalPadding) 0;content:attr(prewrap)}:host([postwrap]):after{padding:var(--verticalPadding) 0;content:attr(postwrap)}#redicle{--orpPercent:calc(var(--orpOffset, 38)/100*100%);position:relative;border-top:4px solid;border-bottom:4px solid;width:10em;padding:var(--verticalPadding) 0;background-repeat:no-repeat;background-position:var(--orpPercent) 0;background-size:100%;display:inline-flex;align-items:center;line-height:1}:host([status=playing]) #redicle{background-image:linear-gradient(90deg,hsla(0,0%,50.2%,.3) 100%,transparent 0);animation:fade calc(var(--msDuration, 240)*6ms) linear forwards}@keyframes fade{to{background-size:0}}#redicle:after,#redicle:before{content:"";border:2px solid;position:absolute;height:calc(var(--verticalPadding)/2);left:var(--orpPercent)}#redicle:before{top:0}#redicle:after{bottom:0}#word{transform:translatex(var(--wordOffset));min-height:2.2ex;flex:1}#word b{font-weight:inherit;color:var(--spritz-orp-accent,red)}</style><div id="redicle">\n  <span id="word"></span>\n</div>',this._$redicle=this.shadowRoot.getElementById("redicle"),this._$word=this.shadowRoot.getElementById("word")}static get observedAttributes(){return["content","index","status","wpm"]}connectedCallback(){this._$redicle.addEventListener("animationend",()=>this._play())}attributeChangedCallback(t,e,s){e!==s&&("index"===t&&this._render(),"wpm"===t&&this._$redicle.style.setProperty("--msDuration",this.duration),"status"===t&&this._handleStatusChange(s),"content"===t&&this._processById(s))}get duration(){return 6e4/this.wpm}get estimatedMinutes(){return this._words.length/this.wpm}get content(){return this.getAttribute("content")}set content(t){m({elem:this,key:"content",value:t})}get index(){return parseInt(this.getAttribute("index"))}set index(t){let e=-1;isNaN(t)||(e=parseInt(t),f(e,this._words)!==e&&-1!==e||this.setAttribute("index",e))}get status(){return this.getAttribute("status")}set status(t){const e=Object.values(w).includes(t)?t:w.STATUS_STOPPED;this.setAttribute("status",e)}get wpm(){return Number(this.getAttribute("wpm"))}set wpm(t){m({elem:this,key:"wpm",value:t,check:t=>!isNaN(t)&&parseInt(t,10)>0})}fastbackward(){return this.pause(),this.index=this._jumpBackward(),this._emitEvent("fastbackward"),this}fastforward(){return this.pause(),this.index=this._jumpForward(),this._emitEvent("fastforward"),this}pause(){return this.status="paused",this}play(){return this.status="playing",this}process(t){return this._init(),this._words=function(t,e){if(!t)return;const s=new a;return t.replace(u,"$1- ").match(l).filter(t=>/[\w]/.test(t)).map((t,n,i)=>(/[.?!]/.test(t)&&i[n+1]&&e.push(n+1),{content:t.replace(r,""),orp:p(t),...s.check(t)}))}(t,this._sentenceIndices),this._words.length&&this._emitEvent("ready"),this}stepbackward(){return this.pause(),this.index--,this._emitEvent("stepbackward"),this}stepforward(){return this.pause(),this.index++,this._emitEvent("stepforward"),this}stop(){return this.status="stopped",this}_emitEvent(t){this.dispatchEvent(new CustomEvent(t))}_getSentenceIndex(){const t=this._sentenceIndices.find(t=>t>=this.index),e=this._sentenceIndices.indexOf(t);return t!==this.index?f(e-1,this._sentenceIndices):e}_handleStatusChange(t){t===w.STATUS_PAUSED&&this._pause&&this._pause(),t===w.STATUS_STOPPED&&(this._pause&&this._pause(),this.index=-1),this._emitEvent(t)}_init(){this._orpOffset=38,this._sentenceIndices=[0],this._words=[],this.index=-1,this.wpm=250}_jumpBackward(){const t=f(this._getSentenceIndex()-1,this._sentenceIndices);return this._sentenceIndices[t]}_jumpForward(){const t=f(this._getSentenceIndex()+1,this._sentenceIndices);return this._sentenceIndices[t]}_play(){if(!this._words.length||!this._words[this.index+1])return this.stop();this.index+=1;const t=function(t,e){if(!e)return t;const{content:s}=e;return t*=h.clause(s),t*=h.number(s),t*=h.sentence(s)}(this.duration,this._words[this.index]);this._pause=function(t,e){let s;const n=()=>window.cancelAnimationFrame(s),i=(new Date).getTime(),r=()=>(new Date).getTime()-i>=e?(t(),void n()):(s=window.requestAnimationFrame(r),n);return r()}(()=>this._play(),t)}_processById(t){if("complete"!==document.readyState)return document.addEventListener("readystatechange",()=>this._processById(t),{once:!0});const e=document.getElementById(t);e&&this.process(e.textContent)}_render(){if(!~this.index)return this._reset();const t=this._words[this.index];this._$word.innerHTML=function({content:t,orp:e}){return t.replace(/./g,(t,s)=>s===e?`<b>${t}</b>`:t)}(t);const e=function(t,e){return 100*(t.offsetLeft+Math.ceil(t.offsetWidth/2)-2)/e.offsetWidth}(this._$word.querySelector("b"),this._$redicle);this._$word.style.setProperty("--wordOffset",this._orpOffset-e+"%"),m({elem:this,key:"prewrap",value:t.start}),m({elem:this,key:"postwrap",value:t.end})}_reset(){this._$word.innerHTML="",this._$word.removeAttribute("style"),m({elem:this,key:"prewrap",value:!1}),m({elem:this,key:"postwrap",value:!1})}get _orpOffset(){return this._$redicle.style.getPropertyValue("--orpOffset")}set _orpOffset(t){this._$redicle.style.setProperty("--orpOffset",t)}}var g=void window.customElements.define("spritz-ui",_);t.SpritzUI=_,t.default=g,Object.defineProperty(t,"__esModule",{value:!0})}));
